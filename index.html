<!doctype html>
<html lang="es-MX">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maestro Inventarios | El Cedro</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- SheetJS (XLSX) -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- Chart.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script defer src="app.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">EC</div>
      <div>
        <div class="title">Maestro Inventarios</div>
        <div class="subtitle">Carga tu archivo (XLSX/CSV) y analiza por sucursal</div>
      </div>
    </div>

    <div class="actions">
      <label class="upload">
        <input id="fileInput" type="file" accept=".xlsx,.xls,.csv" />
        <span>üì§ Cargar archivo</span>
      </label>
      <button id="btnClear" class="btn secondary" disabled>Limpiar</button>
    </div>
  </header>

  <main class="container">
    <section id="status" class="card status">
      <div class="status-left">
        <div class="status-title">Estado</div>
        <div id="statusMsg" class="status-msg">Carga un archivo para comenzar.</div>
        <div id="statusMeta" class="status-meta"></div>
      </div>
      <div class="status-right">
        <div class="pill" id="pillPrivacy">‚úÖ Procesamiento local (no se sube a internet)</div>
      </div>
    </section>

    <section class="card tabs">
      <button id="tabSummary" class="tab active" disabled>Resumen General</button>
      <button id="tabDetail" class="tab" disabled>Detalle por Sucursal</button>
      <div class="tab-note">Clic para cambiar de vista</div>
    </section>

    <!-- ================== RESUMEN GENERAL ================== -->
    <section id="summaryView" class="view">
      <section class="card kpis">
        <div class="card-header">
          <h2>Foto General</h2>
          <div class="hint">Umbrales: Riesgo &lt; 15 d√≠as ‚Ä¢ Sobreinventario &gt; 60 d√≠as</div>
        </div>

        <div class="kpi-grid kpi-grid-4">
          <div class="kpi">
            <div class="kpi-label">SKUs</div>
            <div class="kpi-value" id="gSkus">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Inv total (pzas)</div>
            <div class="kpi-value" id="gInv">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">% Riesgo (&lt;15 d√≠as)</div>
            <div class="kpi-value" id="gRisk">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">% Sobreinv (&gt;60 d√≠as)</div>
            <div class="kpi-value" id="gOver">‚Äî</div>
          </div>
        </div>
      </section>

      <section class="grid2">
        <section class="card chart-card">
          <div class="card-header">
            <h2>Distribuci√≥n Cobertura (d√≠as)</h2>
            <div class="hint">0‚Äì15, 16‚Äì30, 31‚Äì60, 61‚Äì120, &gt;120</div>
          </div>
          <div class="chart-wrap">
            <canvas id="chartHist"></canvas>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <h2>Hallazgos autom√°ticos</h2>
            <div class="hint">Texto listo para direcci√≥n</div>
          </div>
          <ul id="insights" class="insights"></ul>
        </section>
      </section>

      <!-- ‚úÖ DIAGN√ìSTICO (oculto por default) -->
      <section class="card" style="margin-top:12px;">
        <div class="card-header">
          <h2>Diagn√≥stico de columnas</h2>

          <div style="display:flex; gap:10px; align-items:center;">
            <div class="hint">Solo para admin (debug)</div>
            <button id="btnToggleDiag" class="btn secondary" type="button" style="padding:8px 10px;">
              Mostrar diagn√≥stico
            </button>
          </div>
        </div>

        <div id="diagWrap" class="hidden" style="margin-top:10px;">
          <div id="diagBox"
               class="hint2"
               style="
                 white-space:pre-wrap;
                 font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
                 background: rgba(0,0,0,.18);
                 border:1px solid rgba(255,255,255,.08);
                 padding:12px;
                 border-radius:16px;
                 overflow:auto;
                 max-height:260px;">
            ‚Äî
          </div>
        </div>
      </section>
    </section>

    <!-- ================== DETALLE POR SUCURSAL ================== -->
    <section id="detailView" class="view hidden">
      <section class="grid">
        <section class="card filters">
          <div class="card-header">
            <h2>Filtros</h2>
            <div class="hint">Clic en encabezados para ordenar</div>
          </div>

          <div class="form">
            <div class="field">
              <label>Sucursal</label>
              <select id="warehouseSelect" disabled></select>
            </div>

            <div class="field">
              <label>Clasificaci√≥n</label>
              <select id="classSelect" disabled>
                <option value="ALL">Todas</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="Sin Mov">Sin Mov</option>
              </select>
            </div>

            <div class="field">
              <label>B√∫squeda (C√≥digo o Descripci√≥n)</label>
              <input id="searchInput" type="text" placeholder="Ej. BER 001600-4 o BARNIZ..." disabled />
            </div>

            <div class="field">
              <label>Solo inventario &gt; 0</label>
              <label class="switch">
                <input id="onlyInvToggle" type="checkbox" disabled />
                <span class="slider"></span>
              </label>
            </div>

            <div class="field">
              <label>Rango Cobertura (D√≠as)</label>
              <div class="range">
                <input id="covMin" type="number" placeholder="M√≠n" disabled />
                <input id="covMax" type="number" placeholder="M√°x" disabled />
              </div>
              <div class="hint2">Deja vac√≠o para no filtrar</div>
            </div>

            <button id="btnExport" class="btn" disabled>‚¨áÔ∏è Exportar vista (CSV)</button>
          </div>
        </section>

        <section class="card kpis">
          <div class="card-header">
            <h2>KPIs sucursal</h2>
            <div class="hint">Recalculados con filtros</div>
          </div>

          <div class="kpi-grid kpi-grid-4">
            <div class="kpi">
              <div class="kpi-label">Meses usados</div>
              <div class="kpi-value" id="kpiMeses">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">SKUs (vista)</div>
              <div class="kpi-value" id="kpiSkus">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Inv total (piezas)</div>
              <div class="kpi-value" id="kpiInv">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Cobertura (d√≠as) mediana</div>
              <div class="kpi-value" id="kpiCobMed">‚Äî</div>
            </div>
          </div>
        </section>

        <section class="card table-card">
          <div class="card-header">
            <h2>Tabla</h2>
            <div class="hint" id="tableHint">‚Äî</div>
          </div>

          <div class="table-wrap">
            <table id="dataTable">
              <thead></thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>
    </section>
  </main>

  <footer class="footer">
    <div>¬© El Cedro ‚Ä¢ Web local para an√°lisis interno ‚Ä¢ No sube archivos</div>
  </footer>

  <!-- ‚úÖ Script peque√±o SOLO para mostrar/ocultar (no toca app.js) -->
  <script>
    (function(){
      const btn = document.getElementById("btnToggleDiag");
      const wrap = document.getElementById("diagWrap");
      if(!btn || !wrap) return;

      btn.addEventListener("click", () => {
        const hidden = wrap.classList.contains("hidden");
        wrap.classList.toggle("hidden", !hidden);
        btn.textContent = hidden ? "Ocultar diagn√≥stico" : "Mostrar diagn√≥stico";
      });
    })();
  </script>
</body>
</html>
